<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js\components\maps\assignmentMap.js - The cros-admin API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="The cros-admin API" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/CustomAdapter.html">CustomAdapter</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/cros-admin.html">cros-admin</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js\components\maps\assignmentMap.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Created by matthias on 3/04/2015.
 */

App.AssignmentMapComponent = App.PopupMapComponent.extend({

    icon : L.icon({
        iconUrl: &#x27;img/checkpointMarker.png&#x27;,
        shadowUrl: &#x27;img/marker-shadow.png&#x27;,

        iconSize:     [40, 40], // size of the icon
        shadowSize:   [0,  0 ], // size of the shadow
        iconAnchor:   [20, 20], // point of the icon which will correspond to marker&#x27;s location
        shadowAnchor: [0 , 0 ],  // the same for the shadow
        popupAnchor:  [0,  0 ] // point from which the popup should open relative to the iconAnchor
    }),
    droneIcon : L.icon({
        iconUrl: &#x27;img/droneMarker.png&#x27;,
        shadowUrl: &#x27;img/marker-shadow.png&#x27;,

        iconSize:     [40, 40], // size of the icon
        shadowSize:   [0,  0 ], // size of the shadow
        iconAnchor:   [20, 20], // point of the icon which will correspond to marker&#x27;s location
        shadowAnchor: [0 , 0 ],  // the same for the shadow
        popupAnchor:  [0,  0 ] // point from which the popup should open relative to the iconAnchor
    }),
    polyline : null,

    initialization : function(){
        this._super();
        this.updatepolyLine();

        var polyline = L.polyline([], {color: &#x27;#1abc9c&#x27;, opacity: 1}).addTo(this.get(&#x27;map&#x27;)); // TODO: smooth factor?
        this.set(&#x27;dronePolyline&#x27;, polyline);

        this.addObserver(&#x27;droneLocation.lon&#x27;,this,this.updateMarker);
        this.addObserver(&#x27;droneLocation.lat&#x27;,this,this.updateMarker);
        this.addObserver(&#x27;droneLocation.lon&#x27;,this,this.updateMap);
        this.addObserver(&#x27;droneLocation.lat&#x27;,this,this.updateMap);
    },

    updatepolyLine : function() {
        if (this.get(&quot;polyline&quot;)) {
            var pos = this.get(&quot;polyline&quot;).getLatLngs();

            var markers = this.get(&quot;marker&quot;) || [];
            var needsUpdate = false;
            $.each(markers,function(i) {
                if (pos[i]) {
                    needsUpdate = needsUpdate || this.lat != pos[i].lat || this.lon != pos[i].lon;
                } else {
                    needsUpdate = true;
                }
            });
            if (!needsUpdate)
                return;

            this.get(&quot;map&quot;).removeLayer(this.get(&quot;polyline&quot;));
        }
        var polyline = L.polyline([], {color: &#x27;blue&#x27;}).addTo(this.get(&#x27;map&#x27;));
        $.each(this.get(&#x27;marker&#x27;), function(index,data) {
            polyline.addLatLng(data.getLatLng());
        });
        this.set(&#x27;polyline&#x27;, polyline);

        if (this.get(&#x27;dronePolyline&#x27;) &amp;&amp; this.get(&#x27;droneLocation&#x27;))
            this.get(&#x27;dronePolyline&#x27;).addLatLng(this.get(&#x27;droneLocation&#x27;));
    },

    updateMarker : function() {
        this._super();

        var drone = this.get(&quot;droneLocation&quot;);
        var marker = this.get(&quot;droneMarker&quot;);
        if (drone) {
            if (marker) {
                marker.setLatLng(drone);
            } else {
                var marker = L.marker(drone, {id: null, icon: this.get(&quot;droneIcon&quot;)}).addTo(this.get(&#x27;map&#x27;));
                this.set(&quot;droneMarker&quot;, marker);
            }
        } else {
            if (marker) {
                this.get(&quot;map&quot;).removeLayer(marker);
                this.set(&quot;droneMarker&quot;, null);
            }
        }

        this.updatepolyLine();
    },

    updateMap : function() {
        if (!this.get(&quot;centered&quot;))
            return;

        var loc = this.get(&#x27;location&#x27;);
        var map = this.get(&#x27;map&#x27;);
        updateZoom = typeof(updateZoom) === &quot;boolean&quot; ? updateZoom : false;

        if (map) {
            var zoomLevel = updateZoom || typeof(map.getZoom()) !== &quot;number&quot; ? 13 : map.getZoom();
            if (! loc)
                map.fitBounds([{lat:51.051045, lon:3.706872},
                    {lat:51.020118,lon:3.740603}], {padding:[50,50]});
            else if (loc instanceof Array) {
                if (this.get(&quot;droneLocation&quot;))
                    loc = loc.concat(this.get(&quot;droneLocation&quot;));
                map.fitBounds(loc, {padding: [50, 50]});
            } else
                map.setView(loc,zoomLevel);
        }
    }

});
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
